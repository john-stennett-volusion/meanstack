{"version":3,"sources":["api.js"],"names":[],"mappings":"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","file":"api-compiled.js","sourcesContent":["'use strict';\n\nlet express = require('express');\nlet status  = require('http-status');\n\nmodule.exports = (wagner) => {\n\tlet api = express.Router();\n\n\tapi.get('/product/id/:id', wagner.invoke((Product) => {\n\t\treturn (req, res) => {\n\t\t\tProduct.findOne({_id: req.params.id},\n\t\t\t\thandleOne.bind(null, 'product', res));\n\t\t};\n\t}));\n\n\tapi.get('/product/category/:id', wagner.invoke((Product) => {\n\t\treturn (req, res) => {\n\t\t\tlet sort = {name: 1};\n\n\t\t\tif (req.query.price === '1') {\n\t\t\t\tsort = {'internal.approximatePriceUSD': 1};\n\t\t\t} else if (req.query.price === '-1') {\n\t\t\t\tsort = {'internal.approximatePriceUSD': -1};\n\t\t\t}\n\n\t\t\tProduct.find({'category.ancestors': req.params.id}).sort(sort).exec(handleMany.bind(null, 'products', res));\n\t\t};\n\t}));\n\n\tapi.get('/category/id/:id', wagner.invoke((Category) => {\n\t\treturn (req, res) => {\n\t\t\tCategory.findOne({_id: req.params.id}, (error, category) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn res.status(status.INTERNAL_SERVER_ERROR).json({error: error.toString()});\n\t\t\t\t}\n\t\t\t\tif (!category) {\n\t\t\t\t\treturn res.status(status.NOT_FOUND).json({error: 'Not found'});\n\t\t\t\t}\n\t\t\t\tres.json({category: category});\n\t\t\t});\n\t\t};\n\t}));\n\n\tapi.get('/category/parent/:id', wagner.invoke((Category) => {\n\t\treturn (req, res) => {\n\t\t\tCategory.find({parent: req.params.id}).sort({_id: 1}).exec((error, categories) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn res.status(status.INTERNAL_SERVER_ERROR).json({error: error.toString()});\n\t\t\t\t}\n\t\t\t\tres.json({categories: categories});\n\t\t\t});\n\t\t};\n\t}));\n\n\treturn api;\n};\n\nfunction handleOne(property, res, error, result) {\n\tif (error) {\n\t\treturn res.status(status.INTERNAL_SERVER_ERROR).json({error: error.toString()});\n\t}\n\tif (!result) {\n\t\treturn res.status(status.NOT_FOUND).json({error: 'Not found'});\n\t}\n\n\tvar json = {};\n\tjson[property] = result;\n\tres.json(json);\n}\n\nfunction handleMany(property, res, error, result) {\n\tif (error) {\n\t\treturn res.status(status.INTERNAL_SERVER_ERROR).json({error: error.toString()});\n\t}\n\n\tvar json = {};\n\tjson[property] = result;\n\tres.json(json);\n}"]}