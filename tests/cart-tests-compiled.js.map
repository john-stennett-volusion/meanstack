{"version":3,"sources":["cart-tests.js"],"names":[],"mappings":"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","file":"cart-tests-compiled.js","sourcesContent":["'use strict';\n\nlet assert     = require('assert');\nlet express    = require('express');\nlet status     = require('http-status');\nlet superagent = require('superagent');\nlet wagner     = require('wagner-core');\n\nconst URL_ROOT = 'http://localhost:3000';\nlet PRODUCT_ID = '000000000000000000000001';\n\ndescribe('Cart API', () => {\n\tlet server;\n\tlet Category;\n\tlet Product;\n\tlet User;\n\n\tbefore(() => {\n\t\tlet app = express();\n\n\t\t// Bootstrap server\n\t\tlet models = require('../models/models')(wagner);\n\n\t\t// Make Category model available in tests.\n\t\tCategory = models.Category;\n\t\tProduct  = models.Product;\n\t\tUser     = models.User;\n\n\t\tapp.use((req, res, next) => {\n\t\t\tUser.findOne({}, (error, user) => {\n\t\t\t\tassert.ifError(error);\n\t\t\t\treq.user = user;\n\t\t\t\tnext();\n\t\t\t});\n\t\t});\n\n\t\tapp.use(require('../api')(wagner));\n\n\t\tserver = app.listen(3000);\n\t});\n\n\tafter(() => {\n\t\tserver.close();\n\t});\n\n\tbeforeEach((done) => {\n\t\t// Make sure Categories are empty before each test.\n\t\tCategory.remove({}, (error) => {\n\t\t\tassert.ifError(error);\n\t\t\tProduct.remove({}, (error) => {\n\t\t\t\tassert.isError(error);\n\t\t\t\tUser.remove({}, (error) => {\n\t\t\t\t\tassert.ifError(error);\n\t\t\t\t\tdone();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\tbeforeEach((done) => {\n\t\tlet categories = [\n\t\t\t{ _id: 'Electronics' },\n\t\t\t{ _id: 'Phones', parent: 'Electronics' },\n\t\t\t{ _id: 'Laptops', parent: 'Electronics' },\n\t\t\t{ _id: 'Bacon' }\n\t\t];\n\n\t\tlet products = [\n\t\t\t{\n\t\t\t\tname: 'LG G4',\n\t\t\t\tcategory: { _id: 'Phones', ancestors: ['Electronics', 'Phones'] },\n\t\t\t\tprice: {\n\t\t\t\t\tamount: 300,\n\t\t\t\t\tcurrency: 'USD'\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: PRODUCT_ID,\n\t\t\t\tname: 'Asus Zenbook Prime',\n\t\t\t\tcategory: { _id: 'Laptops', ancestors: ['Electronics', 'Laptops'] },\n\t\t\t\tprice: {\n\t\t\t\t\tamount: 2000,\n\t\t\t\t\tcurrency: 'USD'\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Flying Pigs Farm Pasture Raised Pork Bacon',\n\t\t\t\tcategory: { _id: 'Bacon', ancestors: ['Bacon'] },\n\t\t\t\tprice: {\n\t\t\t\t\tamount: 20,\n\t\t\t\t\tcurrency: 'USD'\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tlet users = [{\n\t\t\tprofile: {\n\t\t\t\tusername: 'vkarpov15',\n\t\t\t\tpicture: 'http://pbs.twimg.com/profile_images/550304223036854272/Wwmwuh2t.png'\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\toauth: 'invalid',\n\t\t\t\tcart: []\n\t\t\t}\n\t\t}];\n\n\t\tCategory.create(categories, (error) => {\n\t\t\tassert.ifError(error);\n\t\t\tProduct.create(products, (error) => {\n\t\t\t\tassert.ifError(error);\n\t\t\t\tUser.create(users, (error) => {\n\t\t\t\t\tassert.ifError(error);\n\t\t\t\t\tdone();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\tafterEach(() => {\n\t\t// Shut the server down when we're done.\n\t\tserver.close();\n\t});\n\n\tit('can save users cart', (done) => {\n\t\tlet url = `${URL_ROOT}/me/cart`;\n\n\t\tsuperagent.put(url).send({\n\t\t\tdata: {\n\t\t\t\tcart: [{ product: PRODUCT_ID, quantity: 1 }]\n\t\t\t}\n\t\t}).end((error, res) => {\n\t\t\tassert.ifError(error);\n\t\t\tassert.equal(res.status, status.OK);\n\n\t\t\tUser.findOne({}, (error, user) => {\n\t\t\t\tassert.ifError(error);\n\t\t\t\tassert.equal(user.data.cart.length, 1);\n\t\t\t\tassert.equal(user.data.cart[0].product, PRODUCT_ID);\n\t\t\t\tassert.equal(user.data.cart[0].quantity, 1);\n\t\t\t\tdone();\n\t\t\t});\n\t\t});\n\t});\n\n\tit('can load users cart', (done) => {\n\t\tlet url = `${URL_ROOT}/me`;\n\n\t\tUser.findOne({}, (error, user) => {\n\t\t\tassert.ifError(error);\n\t\t\tuser.data.cart = [{ product: PRODUCT_ID, quantity: 1 }];\n\t\t\tuser.save((error) => {\n\t\t\t\tassert.ifError(error);\n\n\t\t\t\tsuperagent.get(url, (error, res) => {\n\t\t\t\t\tassert.ifError(error);\n\t\t\t\t\tassert.equal(res.status, status.OK);\n\n\t\t\t\t\tlet result;\n\t\t\t\t\tassert.doesNotThrow(() => {\n\t\t\t\t\t\tresult = JSON.parse(res.text).user;\n\t\t\t\t\t});\n\n\t\t\t\t\tassert.equal(result.data.cart.length, 1);\n\t\t\t\t\tassert.equal(result.data.cart[0].product.name, 'Asus Zenbook Prime');\n\t\t\t\t\tassert.equal(result.data.cart[0].quantity, 1);\n\t\t\t\t\tdone();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n});"]}